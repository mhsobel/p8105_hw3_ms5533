---
title: "Homework 3"
author: "Marisa Sobel"
date: "10/7/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggridges)
library(patchwork)
library(ggthemes)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

## Problem 1 

Data cleaning

```{r, collapse=TRUE}
# add library that includes dataset 
library("p8105.datasets")

# import brfss_smart2010 data, clean names, filter by "Overall Health", remove unwanted vars
# make "response" a factor variable

brfss_data = 
  brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  select(-class, -topic, -question, 
         -sample_size, -(confidence_limit_low:geo_location)) %>% 
  mutate(
    response = factor(response, 
                      levels = c("Excellent", "Very good", "Good", "Fair", "Poor"))
  )

brfss_data
```

### Questions

1. _*In 2002, which states were observed at 7 locations?*_

```{r, collapse=TRUE}
# Filter by year, group by state, summarize number of locations in each state
brfss_data %>% 
  filter(year == 2002) %>% 
  group_by(locationabbr) %>% 
  summarise(
    number = n()
  )
```

None (????)

2. _*Make a “spaghetti plot” that shows the number of observations in each state from 2002 to 2010.*_

```{r, collapse=TRUE}
# Group by year and state, summarize number of locations in each state (n)
# Line plot of year vs n
brfss_data %>% 
  group_by(year, locationabbr) %>% 
  summarise(
    number = n()) %>% 
  ggplot(aes(x = year, y = number, color = locationabbr)) +
  geom_line() +
   labs(
    title = "Number of Observations by State (2002-2010)", 
    x = "Year", 
    y = "Number of Obs", 
    legend = "State") +
  viridis::scale_color_viridis(discrete = TRUE) +
  theme(legend.position = "right")

# CANNOT GET LEGEND TO LABEL
```

3. _*Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.*_

```{r}
# Filter: 1) NY, 2) year (2002, 2006, 2010)
# Group by location 
# Confused about how to get proportion, but do notice the order is the same each time (excellent --> poor)

brfss_data %>% 
  filter(locationabbr == "NY") %>% 
  filter(year == 2002 | year == 2006 | year == 2010) %>% 
  group_by(locationdesc)
  
# mutate(prop_excellent = (excellent) /(excellent + very_good + good + fair + poor)) does not work anymore because data structrue is long, not wide
```

4. _*For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.*_

```{r}

```






